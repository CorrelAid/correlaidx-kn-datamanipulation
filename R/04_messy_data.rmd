---
title: "Wrangling messy data"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE}
library(dplyr)
library(tidyr)
library(stringr)
```

# Messy data

Most data out in the wild is *really* messy. The saying goes: tidy datasets are always alike, but every messy data set is messy in its own way. We will look at two examples you will probably encounter if you study/work in the social sciences:

1. Messy/awkwardly formatted data
2. Survey data (this is kind of its own class...)

## Messy or awkwardly formatted

![Tidy data]("figures/tidy_data.jpg")

```{r}
fertility <- readr::read_csv(here::here("data", "wbi_fertility.csv"))
fertility
```

* Column names contain spaces
* Awkward wide format (every year is its own column)
* unneccessary stuff (Series Code?)

```{r}
fertility |> 
  select(-c(`Series Code`, `Series Name`)) |> 
  rename_with(\(x) x |> tolower() |> str_replace(" ", "_")) |> 
  pivot_longer(
    cols = -starts_with("country"), 
    names_to = "year", 
    values_to = "fert"
  ) |> 
  mutate(
    year = str_remove(year, "_(.*)$"), 
    across(c(year, fert), as.numeric)
  )
```

## Survey data

