---
title: "Visualizations"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(gapminder)
data("gapminder")

gm <- gapminder |> filter(year == 2007) # let's stick to one year for now...
```

# The data analysis process

![The data analysis process]("figures/process.png")

So far, you have (hopefully) looked at how to import data, and how to interact with it; maybe done some basic tidying. We now want to do some more tidying, and move into the circle of exploring, transforming, and analyzing your data.

First, we would like to talk about the basics of visualizing data, one because it's one of the most fun things, and two because visualizations can help you explore your data and learn more about it, which you can then use to clean, transform and analyze it!

# Grammar of graphics

A heuristic for thinking about statistical visualizations. What is a visualization?

> A *mapping* of data to *aesthetic attributes* (color, shape, size...) of *geometric objects* (points, lines, bars...)

We work in layers:

```{r}
ggplot()
```

Adding data & mapping:

```{r}
ggplot(data = gm, mapping = aes(x = gdpPercap, y = lifeExp))
```

Adding geometric objects:

```{r}
gm |> 
  ggplot(aes(x = gdpPercap, y = lifeExp)) + # adding layers with "+"
  geom_point()
```

There are more attributes, like `color`:

```{r}
gm |> 
  ggplot(aes(x = gdpPercap, y = lifeExp, color = continent)) + 
  geom_point()
```

* **Exercise:** Read the gapminder data using `read.csv()`, or `readr::read_csv()`. Recreate the above plot, and map `size` to the countries' population (`pop`)! *Bonus:* Do you notice anything that could be problematic?

```{r}
gm |> 
  ggplot(aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) + 
  geom_point()

# Bonus: Big countries may now obscure small countries!
```

If we set aesthetic attributes outside `aes()`, they take on static values. For example, `alpha` determines the opaqueness of objects:

```{r}
gm |> 
  ggplot(aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) + 
  geom_point(alpha = 0.5)
```

You can also set labels for axis & legend using `labs()`:

```{r}
gm |> 
  ggplot(aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) + 
  geom_point(alpha = 0.5) +
  labs(
    title = "GDP & Life Expectancy", 
    subtitle = "...for countries from 5 continents",
    x = "GDP p.C.", 
    y = "Life Expectancy (Years)",
    color = "Continent", 
    size = "Population"
  )
```

`ggplot2` also has themes:

```{r}
gm |> 
  ggplot(aes(x = gdpPercap, y = lifeExp, color = continent, size = pop)) + 
  geom_point(alpha = 0.5) +
  labs(
    title = "GDP & Life Expectancy", 
    subtitle = "...for countries from 5 continents",
    x = "GDP p.C.", 
    y = "Life Expectancy (Years)",
    color = "Continent", 
    size = "Population"
  ) +
  theme_minimal()
```

## Other `geom_*`s

Lines (`geom_line()`):

```{r}
gapminder |> 
  filter(country == "Germany") |> 
  ggplot(aes(x = year, y = lifeExp)) +
  geom_line()
```

Bars (`geom_bar()` & `geom_col()` (= columns, aka unretarded bars)):

```{r}
gapminder |> 
  filter(country == "Germany") |> 
  ggplot(aes(x = year, y = gdpPercap)) +
  geom_col()
```

Violin- & Boxplots (`geom_violin()` & `geom_boxplot()`)

```{r}
gapminder |> 
  ggplot(aes(x = year, y = lifeExp, group = year)) +
  geom_boxplot()
```

## Wraps

Let's say you wanted to make the last plot *by continent*. Would you have to `filter()` and make plots for all continents separately? There is of course a smarter way: we can "wrap" the plot by continent:

```{r}
gapminder |> 
  ggplot(aes(x = year, y = lifeExp, group = year, fill = continent)) +
  geom_boxplot() +
  facet_wrap(~continent)
```

## Axes

```{r}
# show "scales::comma_format()" & "scales::percent_format()"
```

